$.fn.promap=function(){$(document).ready(function(){function a(a,b){$(a).mouseenter(function(){$("#imgmapTooltip").show().html(b)}).mouseleave(function(){$("#imgmapTooltip").hide()}).mousemove(function(a){$("#imgmapTooltip").css({left:a.pageX+25,top:a.pageY,position:"absolute"})})}mapdata=new Array,$("img[usemap]").each(function(a,b){var c=$(this).attr("width"),d=$(this).attr("height"),e=$(this).attr("id"),f={imgid:e,mapid:$(this).attr("usemap").substring(1),width:c.indexOf("px")===-1?c:c.substring(0,c.indexOf("px")),height:d.indexOf("px")===-1?d:d.substring(0,d.indexOf("px")),areas:new Array,svgid:"svg_"+e};$("map").each(function(a,b){$(this).attr("name")===f.mapid&&($(this).children("area").each(function(a,b){f.areas.push($(this).attr("coords")+(void 0==$(this).attr("content")?"":"<|>"+$(this).attr("content"))+(void 0==$(this).attr("href")?"":"<|>"+$(this).attr("href")))}),$(this).replaceWith('<svg id="'+f.svgid+'" style="position:absolute;"></svg>'))}),mapdata.push(f)}),$(document.body).append('<div id="imgmapTooltip" class="imgmapTooltip"></div>'),$(window).resize(function(b){mapdata.forEach(function(b){var c=$("#"+b.imgid),d=$("#"+b.svgid),e=c.width(),f=c.height();d.offset(c.offset()),d.height(f),d.width(e),d.css({padding:c.css("padding")}),d.css({margin:c.css("margin")}),d.html("");var g=Snap("#"+b.svgid);b.areas.forEach(function(c,d){for(var h=c.split("<|>"),i=h[0].replace(" ","").split(","),j=0;j<i.length;j+=2)i[j]=parseInt(i[j]*e/b.width),i[j+1]=parseInt(i[j+1]*f/b.height);var k=b.svgid+"_poly"+d;switch(h.length){case 1:g.polygon().attr({id:k,class:"poly-noaction",points:i});break;case 2:"http"===h[1].substring(0,4)?g.polygon().attr({id:k,class:"poly-action poly-link",points:i}).click(function(){window.location.href=h[1]}):(g.polygon().attr({id:k,class:"poly-noaction poly-content",points:i}),a("#"+k,h[1]));break;case 3:g.polygon().attr({id:k,class:"poly-action poly-content poly-link",points:i}).click(function(){window.location.href=h[2]}),a("#"+k,h[1])}})})}).trigger("resize"),setTimeout(function(){$(window).trigger("resize")},1e3)})};
